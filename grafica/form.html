<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="./cssform.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <title>Document</title>
</head>
<body>
    <!--
    <form action="../login.php" method="post" aria-label="Form di login">
        <div id="loginForm" class="container-sm p-2 my-3 my-md-5 border border-2 border-dark rounded bg-body-secondary text-center">
                <div class="row">
                    <div class="col-1">
                        <div class="btn-close bg-danger border border-2 rounded-circle" aria-label="Bottone di chiusura"></div>
                    </div>
                    <div class="col-11">
                        <div class="h3">Accedi</div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-md-6">
                        <div class="col my-4 mx-2">
                            <input type="email" class="form-control" name="email" id="email" placeholder="Email" aria-label="Input per email">
                        </div>
                        <div class="col my-4 mx-2">
                            <input type="password" class="form-control" name="pass" id="password" placeholder="Password" aria-label="Input per password">
                        </div>
                        <div class="col my-2 mx-2 text-start">
                            <div class="form-check form-switch">
                                <label class="form-check-label" for="rememberMeCheck">Ricordami</label>
                                <input class="form-check-input" type="checkbox" id="rememberMeCheck" name="rememberMe">
                            </div>
                        </div>
                        <div class="col mt-5 mx-2">
                            <input type="submit" class="form-control bg-primary" name="submit" value="Invia" aria-label="Invia">
                        </div>
                        
                    </div>
                    <div class="col-12 col-md-6 my-2">
                        <img src="login.jpg" alt="Immagine con bambino in smoking che dice: 'Fai login perfavore'" width="238">
                    </div>
                </div>
        </div>
    </form>-->
    
    <form id="form" action="../registration.php" method="post" aria-label="Form di registrazione">
        <div id="registrationForm" class="container-sm p-2 my-3 my-md-5 border border-2 border-dark rounded bg-body-secondary text-center">
                <div class="row">
                    <div class="col-1">
                        <div class="btn-close bg-danger border border-2 rounded-circle" aria-label="Bottone di chiusura del form di login"></div>
                    </div>
                    <div class="col-11">
                        <div class="h3">Registrati</div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-md-6">
                        <div class="col mt-3 mx-2">
                            <input type="text" class="form-control" name="firstname" id="firstname" placeholder="Nome" aria-label="Input per nome">
                        </div>
                        <div class="col my-1 mx-2">
                            <input type="text" class="form-control" name="lastname" id="lastname" placeholder="Cognome" aria-label="Input per cognome">
                        </div>
                        <div class="col mt-1 mx-2">
                            <input type="email" class="form-control" name="email" id="email" placeholder="Email" aria-describedby="emailFeedback">
                            <div id="emailFeedback" class="feedback invalid-feedback">Inserisci la tua email</div>
                        </div>
                        <div class="col mt-1 mx-2">
                            <input type="password" class="form-control" name="pass" id="password" placeholder="Password" aria-label="Input per password" >
                        </div>
                        <div class="col mt-1 mx-2">
                            <input type="password" class="form-control" name="confirm" id="confirm" placeholder="Conferma password" aria-describedby="confirmFeedback">
                            <div id="confirmFeedback" class="invalid-feedback">Conferma la tua password</div>
                        </div>
                        <div class="col my-3">
                            <input type="submit" class="form-control bg-primary" name="submit" value="Invia" aria-label="Invia i dati inseriti" id="submit">
                        </div>
                    </div>
                    <div class="col-12 col-md-6 my-3">
                        <img src="register.jpg" alt="Immagine di Yoda che dice: 'Register now you must'" width="238">
                    </div>
                </div>
        </div>
    </form>

    
    <script>
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const result = urlParams.get('esito')
        if(result!=null)alert(result);

        document.getElementById("form").addEventListener("submit", function(event){
            event.preventDefault();

            password=document.getElementById("password");
            confirm=document.getElementById("confirm");
            confirmFeedback=document.getElementById("confirmFeedback");
            email = document.getElementById("email");
            emailFeedback = document.getElementById("emailFeedback");

            if(password.value!=confirm.value){
                password.classList.add("is-invalid");
                confirm.classList.add("is-invalid");
                confirmFeedback.textContent="Le password non coincidono";
                return;
            }

            password.classList.remove("is-invalid");
            confirm.classList.remove("is-invalid");
            confirmFeedback.textContent="Conferma la tua password";

            dati = new FormData(this);//associo i dati del form a quelli da inviare con la fetch
            fetch("../registration.php",
            {
                method: "POST",
                body: dati
            }).then(function(response){
                if(response.ok){
                    return response.text();
                }else{
                    console.log(response);
                    throw new Error("Errore nella richiesta AJAX");
                }
            }).then(function(text){
                alert(text);
                if(text=="OK"){
                    window.location.href = "register.jpg";
                }else{
                    email.classList.add("is-invalid");
                    emailFeedback.textContent="Email gi√† in uso";
                }    
            }).catch(function(error){
                alert("Errore SERVER");
            });

        });
    </script>
</body>
</html>